@model WendlandtVentas.Web.Models.ClientViewModels.ClientOrdersViewModel

@{
    Layout = "~/Views/Shared/_ClientLayout.cshtml";
    ViewData["Title"] = "Estado de Cuenta";
}

<head>
    <link href="~/css/custom.css" rel="stylesheet" />
</head>



<header class="top-bar">
    <div class="container top-bar-container">
        <a class="logo">
            <img src="~/images/logo.png" alt="Logo Wendlandt Ventas" />
        </a>
        <div class="navbar-title">
            ESTADO DE CUENTA <br />
            <h2 class="nombre-cliente">@Model.ClientName</h2>
        </div>
        <div class="placeholder"></div> <!-- Para balancear el flex -->
    </div>
</header>


<!-- Campo de Búsqueda y Botón de Filtro -->
<div class="row mb-4 mt-3">
    <div class="col-md-6 m-auto">
        <input type="text" class="form-control" placeholder="Buscar cliente por remisión o fáctura" id="searchField" />
    </div>
    <div class="col-md-6">
        <button class="btn btn-primary" id="filterButton">Filtrar</button>
    </div>
</div>

<!-- Cuatro Cards para mostrar resumen de cuenta -->
<div class="cards-especiales row mb-4">
    <div class="col-md-3">
        <div class="card shadow-sm text-center">
            <div class="card-body">
                
                <p class="card-text text-paid">@Model.PaidAmount.ToString("C2")</p> <!-- Verde oscuro -->
                <span class="card-title">Total Pagado</span>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm text-center">
            <div class="card-body">
                <p class="card-text">$0</p> <!-- Mostrar cantidad de devoluciones -->
                <span class="card-title">Devoluciones</span>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm text-center">
            <div class="card-body">
                <p class="card-text text-center text-due ">@Model.TotalPendientes</p> <!-- Cuantas cuentas pendientes por pagar -->
                <span class="card-title">Cuentas Pendientes</span>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm text-center">
            <div class="card-body">
                <p class="card-text text-due">@Model.TotalPorPagar.ToString("C2")</p> <!-- Mostrar total por pagar -->
                <span class="card-title">Total por Pagar</span>
            </div>
        </div>
    </div>
</div>

<div class="tabla-especial tabla-scroll">
    <table class="table table-striped shadow-sm">
        <thead>
            <tr>
                <th>Remisión</th>
                <th>Factura</th>
                <th>Fecha de Entrega</th>
                <th>Fecha de Vencimiento</th>
                <th>Monto</th>
            </tr>
        </thead>
        <tbody id="balanceTableBody">
            @foreach (var item in Model.Balances)
            {
                var collapseId = $"collapse-{item.RemissionCode}";

                <tr class="@(item.isPaid == true ? "fila-pagada" : "fila-pendiente")">
                    <td>@item.RemissionCode</td>
                    <td>@item.InvoiceCode</td>
                    <td>@item.DeliveryDate.ToString("dd/MM/yyyy")</td>
                    <td>@item.DueDate.ToString("dd/MM/yyyy")</td>
                    <td>@item.AmountString</td>
                </tr>
            }
        </tbody>
    </table>
</div>


<!-- JavaScript para el botón de filtro -->
<script>
    document.getElementById("filterButton").addEventListener("click", function () {
        var searchText = document.getElementById("searchField").value.toLowerCase().trim();
        var rows = document.querySelectorAll("#balanceTableBody tr");

        rows.forEach(function (row) {
            var rowText = row.innerText.toLowerCase();
            if (rowText.includes(searchText)) {
                row.style.display = ""; // Mostrar
            } else {
                row.style.display = "none"; // Ocultar
            }
        });
    });

    // También puedes filtrar al presionar "Enter"
    document.getElementById("searchField").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            document.getElementById("filterButton").click();
        }
    });
</script>
